<?xml version="1.0" encoding="US-ASCII"?>
<!-- this is version 5 of this xml2rfc template -->
<!DOCTYPE rfc SYSTEM "rfc2629.dtd" [
<!ENTITY rfc2119 SYSTEM "https://xml.resource.org/public/rfc/bibxml/reference.RFC.2119.xml">
<!ENTITY rfc7468 SYSTEM "https://xml.resource.org/public/rfc/bibxml/reference.RFC.7468.xml">
<!ENTITY rfc8174 SYSTEM "https://xml.resource.org/public/rfc/bibxml/reference.RFC.8174.xml">
<!ENTITY rfc8446 SYSTEM "https://xml.resource.org/public/rfc/bibxml/reference.RFC.8446.xml">
<!ENTITY I-D.ietf-tls-esni SYSTEM "http://xml.resource.org/public/rfc/bibxml3/reference.I-D.ietf-tls-esni">

]>
<?rfc toc="yes"?>
<?rfc symrefs="yes"?>
<?rfc compact="yes"?>
<?rfc subcompact="yes"?>
<?rfc strict="no"?>
<?rfc rfcedstyle="yes"?>
<?rfc comments="yes"?>
<?rfc inline="yes"?>
<rfc category="exp" docName="draft-farrell-tls-pemesni-00" ipr="trust200902" >
  <front>
    <title abbrev="PEM file format for ESNI">PEM file format for ESNI</title>

    <author fullname="Stephen Farrell" initials="S." surname="Farrell">
      <organization>Trinity College Dublin</organization>

      <address>
        <postal>
          <street/>

          <city>Dublin</city>

          <region/>

          <code>2</code>

          <country>Ireland</country>
        </postal>

        <phone>+353-1-896-2354</phone>

        <email>stephen.farrell@cs.tcd.ie</email>
      </address>
    </author>

    <date year="2019"/>

    <area>Security Area</area>

    <workgroup>TLS</workgroup>

    <keyword>TLS</keyword>

    <keyword>ESNI</keyword>

    <abstract>
        <t>Encrypted SNI key pairs need to be configured into TLS servers, some of which
            can be built with different TLS libraries, so there is a benefit and
            little cost in documenting a file format to use for these, similar to
            how RFC7468 defines other PEM file formats.
            </t> 
    </abstract>
  </front>

  <middle>
    <section title="Introduction">

        <t>Encrypted Server Name Indication (ESNI) 
            <xref target="I-D.ietf-tls-esni"/> for TLS1.3 <xref target="RFC8446"/>
            defines a confidentiality mechanism for server names in TLS.
            That requires publication of an ESNIKeys data structure in the DNS.
            An ESNIKeys structure contains the public component of a key pair
            that will typically be periodically (re-)generated by some key manager
            for a TLS server.
            TLS servers then need to be configured to use these key pairs, 
            and given that various TLS servers can be built with different
            TLS libraries, there is a benefit in having a standard format for
            ESNI key pairs, just as was done with <xref target="RFC7468"/>. 
        </t>

        <t>[[This idea could: a) wither on the vine
                              b) be published as it's own RFC
                              c) end up as a PR for <xref target="I-D.ietf-tls-esni"/>.
          
            There is no absolute need for this to be in the RFC that
            defines ESNI, so (b) seems feasible if there's enough
            interest, hence this draft.
            
            The source for this is available at https://github.com/sftcd/pemesni 
            where PRs are welcome.]]
        </t>

      </section>

      <section title="Terminology">
        <t>The key words "MUST", "MUST NOT", "REQUIRED", "SHALL", "SHALL NOT",
        "SHOULD", "SHOULD NOT", "RECOMMENDED", "NOT RECOMMENDED", "MAY", and
        "OPTIONAL" in this document are to be interpreted as described in BCP
        14 <xref target="RFC2119"/> <xref target="RFC8174"/> when, and only
        when, they appear in all capitals, as shown here.</t>
      </section>

      <section title="ESNIKeys file">

              <t>The public and private keys MUST both
                  be PEM encoded. The file contains the catenation of the PEM encoding
                  of the private key followed by the PEM encoding of the public key. 
                  The private key MUST be encoded as a PKCS#8 PrivateKey. The public
                  key MUST be the base64 encoded form of the binary ESNIKeys value that 
                  is published in the DNS. The string "ESNIKEY" MUST be used in the PEM
                  file delimiter for the public key.</t>

              <t>There MUST only be one key pair in each file even if a server publishes
                  multiple public keys in one ESNIKeys structure.</t>

              <t><xref target="sample"/> shows an example ESNI PEM File.</t>

            <figure anchor="sample" title="Exemplar ESNI PEM file" >
            <artwork><![CDATA[
-----BEGIN PRIVATE KEY-----
MC4CAQAwBQYDK2VuBCIEIEDyEDpfvLoFYQi4rNjAxAz7F/Dqydv5IFmcPpIyGNd8
-----END PRIVATE KEY-----
-----BEGIN ESNIKEY-----
/wG+49mkACQAHQAgB8SUB952QOphcyUR1sAvnRhY9NSSETVDuon9/CvoDVYAAhMBAQQAAAAAXYZC
TwAAAABdlBoPAAA=
-----END ESNIKEY-----
            ]]></artwork>
            </figure>

      </section>



    <section title="Security Considerations">
        <t>Storing cryptographic keys in files leaves them vulnerable should
            anyone get shell access to the TLS server machine. The keys, therefore,
            SHOULD NOT be stored insecurely.</t>

    </section>

    <section title="Acknowledgements">
        <t>TBD as needed.</t>
    </section>

  </middle>

  <back>
    <references title="Normative References">
      <?rfc include='reference.RFC.2119'?>
      <?rfc include='reference.RFC.7468'?>
      <?rfc include='reference.RFC.8174'?>
      <?rfc include='reference.RFC.8446'?>
      &I-D.ietf-tls-esni;

    </references>

    <!--
    <references title="Informative References">
    </references>

    <section title="Change Log ">
      <t>[[RFC editor: please remove this before publication.]]</t>

      <t>From -00 to -01:
          <list style="symbols">
              <t>Re-structured a bit after re-reading rfc8615</t>
          </list>
      </t>
    </section>
    -->

  </back>
</rfc>
